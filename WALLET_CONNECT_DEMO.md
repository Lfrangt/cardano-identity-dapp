# 钱包连接演示

## 🎬 新版钱包连接体验

### 设计灵感

参考 msx.com 的优雅钱包连接方式，我们实现了移动端和桌面端都友好的连接体验。

---

## 📱 移动端流程

### 步骤 1: 打开 DApp
```
┌─────────────────────────────┐
│                             │
│   Cardano Identity DApp     │
│                             │
│   ┌───────────────────┐    │
│   │   🚀 快捷连接      │    │
│   │                   │    │
│   │  选择你喜欢的钱包  │    │
│   │     快速连接       │    │
│   └───────────────────┘    │
│                             │
│   ─── 或选择以下钱包 ───    │
│                             │
│   ♾️ Eternl      已安装 →  │
│   🦋 Yoroi      未安装 →   │
│   🎴 Lace       未安装 →   │
│                             │
└─────────────────────────────┘
```

### 步骤 2: 点击快捷连接
```
┌─────────────────────────────┐
│  连接钱包           ✕       │
│  选择一个钱包应用            │
│  📱 移动端                  │
├─────────────────────────────┤
│                             │
│  ┌─────────────────────┐   │
│  │ ♾️  Eternl          │   │
│  │    功能最全面的钱包  │   │
│  │    打开应用      →  │   │
│  └─────────────────────┘   │
│                             │
│  ┌─────────────────────┐   │
│  │ 🦋  Yoroi           │   │
│  │    EMURGO 官方钱包  │   │
│  │    打开应用      →  │   │
│  └─────────────────────┘   │
│                             │
│  ┌─────────────────────┐   │
│  │ 🎴  Lace            │   │
│  │    IOG 官方钱包     │   │
│  │    打开应用      →  │   │
│  └─────────────────────┘   │
│                             │
│  ┌─────────────────────┐   │
│  │ ⭕  OKX Wallet      │   │
│  │    支持多链的钱包   │   │
│  │    打开应用      →  │   │
│  └─────────────────────┘   │
│                             │
└─────────────────────────────┘
```

### 步骤 3: 自动跳转钱包应用

#### 场景 A - 应用已安装
```
DApp 页面
   ↓
点击钱包
   ↓
执行深度链接: eternl://
   ↓
自动打开 Eternl 应用
   ↓
在应用中授权连接
   ↓
自动返回 DApp
   ↓
✅ 连接成功！
```

#### 场景 B - 应用未安装
```
DApp 页面
   ↓
点击钱包
   ↓
尝试深度链接: eternl://
   ↓
应用未响应 (2秒超时)
   ↓
自动跳转应用商店
   ↓
┌─────────────────────────────┐
│   App Store / Google Play   │
│                             │
│   Eternl Wallet             │
│   ⭐⭐⭐⭐⭐ 4.8            │
│                             │
│   [  下  载  ]             │
│                             │
└─────────────────────────────┘
```

---

## 💻 桌面端流程

### 步骤 1: 自动检测已安装钱包
```
页面加载
   ↓
检测 window.cardano
   ↓
发现: eternl, okxwallet
   ↓
标记为"已安装"✓
```

### 步骤 2: 显示钱包状态
```
┌─────────────────────────────┐
│                             │
│   ♾️ Eternl                 │
│      已安装 ✓               │
│      功能最全面的钱包        │
│                          → │
│                             │
├─────────────────────────────┤
│                             │
│   ⭕ OKX Wallet             │
│      已安装 ✓               │
│      支持多链的交易所钱包    │
│                          → │
│                             │
├─────────────────────────────┤
│                             │
│   🦋 Yoroi                  │
│      未安装 ⚠️              │
│      EMURGO 官方轻钱包      │
│                   [安装]    │
│                             │
└─────────────────────────────┘
```

### 步骤 3: 连接钱包
```
点击已安装的钱包
   ↓
调用 window.cardano.eternl.enable()
   ↓
浏览器弹出授权窗口
   ↓
┌─────────────────────────────┐
│   Eternl                    │
│                             │
│   Cardano Identity DApp     │
│   想要连接你的钱包          │
│                             │
│   将可以:                   │
│   • 查看你的地址            │
│   • 查看你的余额            │
│   • 请求交易签名            │
│                             │
│   [拒绝]        [允许]      │
│                             │
└─────────────────────────────┘
   ↓
用户点击[允许]
   ↓
✅ 连接成功！
   ↓
显示钱包信息
```

---

## 🎨 UI 特性对比

### 传统方式
```
┌────────────────┐
│ Eternl  [连接] │
│ Nami    [连接] │
│ Yoroi   [连接] │
└────────────────┘
```
❌ 单调的列表
❌ 没有状态指示
❌ 移动端不友好
❌ 没有视觉反馈

### 新方式
```
┌─────────────────────────────┐
│  🚀 快捷连接                │
│  ↓                          │
│  ┌───────────────────────┐ │
│  │ ♾️ Eternl   已安装 ✓  │ │
│  │    [渐变背景]         │ │
│  │    功能最全面的钱包    │ │
│  │                    → │ │
│  └───────────────────────┘ │
│                             │
│  ┌───────────────────────┐ │
│  │ 🦋 Yoroi    未安装 ⚠️ │ │
│  │    [灰色背景]         │ │
│  │    EMURGO 官方钱包    │ │
│  │          [安装]       │ │
│  └───────────────────────┘ │
└─────────────────────────────┘
```
✅ 优雅的底部弹窗
✅ 清晰的状态显示
✅ 移动端友好
✅ 丰富的视觉效果

---

## 🔄 深度链接工作原理

### URL Scheme 机制

每个钱包应用都注册了独特的 URL Scheme：

```
eternl://       → Eternl 应用
yoroi://        → Yoroi 应用
lace://         → Lace 应用
okx://wallet/   → OKX Wallet 应用
begin://        → Begin 应用
vespr://        → Vespr 应用
```

### 执行流程

```javascript
// 1. 构建深度链接
const deepLink = 'eternl://'

// 2. 尝试打开
window.location.href = deepLink

// 3. 如果应用已安装
// → 操作系统拦截 URL
// → 启动对应应用
// → 应用处理连接请求

// 4. 如果应用未安装
// → URL 无法处理
// → 页面保持原样
// → 2秒后检测未跳转
// → 引导用户下载
setTimeout(() => {
  // 仍在页面，说明应用未安装
  redirectToAppStore()
}, 2000)
```

### OKX Wallet 特殊处理

OKX 需要传递当前页面 URL：

```javascript
const currentUrl = window.location.href
const deepLink = `okx://wallet/dapp/url?dappUrl=${encodeURIComponent(currentUrl)}`

// 例如：
// okx://wallet/dapp/url?dappUrl=https%3A%2F%2Fyour-dapp.vercel.app
```

---

## 📊 用户旅程地图

### 理想路径（已安装应用）
```
1. 用户访问 DApp
   时间: 0s
   
2. 点击"快捷连接"
   时间: +1s
   
3. 选择钱包
   时间: +2s
   
4. 跳转到钱包应用
   时间: +3s (瞬间)
   
5. 在钱包中授权
   时间: +5s
   
6. 返回 DApp
   时间: +6s (自动)
   
7. ✅ 连接成功
   总耗时: ~6秒
```

### 需要安装应用
```
1. 用户访问 DApp
   时间: 0s
   
2. 点击"快捷连接"
   时间: +1s
   
3. 选择钱包
   时间: +2s
   
4. 尝试深度链接
   时间: +3s
   
5. 检测到未安装
   时间: +5s (2秒超时)
   
6. 跳转应用商店
   时间: +6s
   
7. 下载并安装应用
   时间: +30s ~ 2分钟
   
8. 返回 DApp
   
9. 重新点击连接
   
10. ✅ 连接成功
    总耗时: ~2-3分钟 (首次)
```

---

## 🌟 关键特性

### 1. 智能检测
- ✅ 自动识别设备类型（iOS/Android/桌面）
- ✅ 检测已安装的钱包扩展
- ✅ 显示对应的操作选项

### 2. 优雅降级
- ✅ 深度链接失败 → 引导下载
- ✅ 浏览器不支持 → 显示手动步骤
- ✅ 网络错误 → 友好提示

### 3. 视觉反馈
- ✅ 加载动画
- ✅ 状态指示（已安装/未安装）
- ✅ 悬停效果
- ✅ 成功/错误提示

### 4. 用户引导
- ✅ 首次使用提示
- ✅ 下载链接
- ✅ 错误处理说明
- ✅ 常见问题解答

---

## 🎯 对比 msx.com

### 相似之处
| 特性 | msx.com | 我们的实现 |
|------|---------|-----------|
| 底部弹窗 | ✅ | ✅ |
| 钱包图标 | ✅ | ✅ |
| 深度链接 | ✅ | ✅ |
| 移动端优化 | ✅ | ✅ |
| 流畅动画 | ✅ | ✅ |

### 我们的优化
| 特性 | msx.com | 我们的实现 |
|------|---------|-----------|
| 已安装检测 | ❓ | ✅ |
| 状态指示 | 基础 | 详细 ✅ |
| 错误处理 | 基础 | 完善 ✅ |
| 自动下载引导 | ❓ | ✅ |
| 设备类型标识 | ❌ | ✅ |
| 快捷连接按钮 | ❌ | ✅ |

---

## 💡 使用建议

### 首次用户
1. 点击"快捷连接"查看所有钱包
2. 选择你喜欢的钱包
3. 如果未安装，按提示下载
4. 安装后返回 DApp 重新连接

### 有经验用户
1. 直接点击已安装的钱包
2. 在钱包中快速授权
3. 立即开始使用

### 移动端用户
1. 推荐先安装钱包应用
2. 使用快捷连接获得最佳体验
3. 支持多个钱包，随时切换

### 桌面端用户
1. 安装浏览器扩展获得最佳体验
2. 也可使用快捷连接浏览所有选项
3. 支持 Ledger 硬件钱包（通过 Eternl/Lace）

---

## 🎉 总结

通过参考 msx.com 的优秀设计，我们实现了一个：

- 🎨 **美观** - 优雅的 UI 设计
- ⚡ **快速** - 一键连接
- 📱 **友好** - 移动端和桌面端都优化
- 🛡️ **可靠** - 完善的错误处理
- 🎯 **易用** - 清晰的引导

这将大大提升用户的首次体验，降低钱包连接的门槛！

---

**立即体验新的钱包连接方式！** 🚀

*参考：msx.com*  
*实现：Cardano Identity DApp*  
*日期：2025-11-15*

